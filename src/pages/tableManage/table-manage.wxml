<view class="container">
  <view class="header glass-card">
    <text class="page-title">桌位管理</text>
    <button class="add-btn" bindtap="addTable">添加桌位</button>
  </view>

  <!-- 桌位列表 -->
  <view class="table-list">
    <block wx:for="{{tableList}}" wx:key="id">
      <view class="table-item glass-card">
        <view class="table-info">
          <view class="table-header">
            <text class="table-name">{{item.number}}</text>
            <view class="table-status {{item.status === 'available' ? 'available' : 'occupied'}}">
              {{item.status === 'available' ? '空闲' : '已满'}}
            </view>
          </view>
          <view class="table-count">
            <text>当前人数：{{item.currentCount}}/{{item.maxCount}}人</text>
          </view>
          <view class="table-mode">
            <text class="mode-tag {{item.serviceMode}}">{{item.serviceMode === 'ticket' ? '门票制' : '点单制'}}</text>
          </view>
        </view>
        <view class="table-actions">
          <button class="edit-btn" bindtap="editTable" data-id="{{item.id}}">编辑</button>
          <button class="delete-btn" bindtap="deleteTable" data-id="{{item.id}}">删除</button>
        </view>
      </view>
    </block>
  </view>

  <!-- 添加/编辑桌位弹窗 -->
  <view class="modal" wx:if="{{showTableModal}}">
    <view class="modal-mask" bindtap="closeModal"></view>
    <view class="modal-content glass-card">
      <view class="modal-header">
        <text class="modal-title">{{isEdit ? '编辑桌位' : '添加桌位'}}</text>
        <text class="close-btn" bindtap="closeModal">×</text>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">桌号</text>
          <input class="form-input" value="{{currentTable.number}}" bindinput="inputTableNumber" placeholder="请输入桌号（如：1号桌）"/>
        </view>
        <view class="form-item">
          <text class="form-label">最大人数</text>
          <input class="form-input" type="number" value="{{currentTable.maxCount}}" bindinput="inputMaxCount" placeholder="请输入最大人数"/>
        </view>
        <view class="form-item" wx:if="{{isEdit}}">
          <text class="form-label">当前人数</text>
          <input class="form-input" type="number" value="{{currentTable.currentCount}}" bindinput="inputCurrentCount" placeholder="请输入当前人数"/>
        </view>
        <view class="form-item">
          <text class="form-label">服务模式</text>
          <view class="service-mode-options">
            <view class="mode-option {{currentTable.serviceMode === 'ticket' ? 'active' : ''}}" 
                  bindtap="selectServiceMode" 
                  data-mode="ticket">
              <text class="mode-label">门票制</text>
              <text class="mode-desc">固定门票价格，包含单点制内容</text>
            </view>
            <view class="mode-option {{currentTable.serviceMode === 'order' ? 'active' : ''}}" 
                  bindtap="selectServiceMode" 
                  data-mode="order">
              <text class="mode-label">点单制</text>
              <text class="mode-desc">按实际消费点单收费</text>
            </view>
          </view>
        </view>
        
        <!-- 二维码设置 -->
        <view class="form-item">
          <text class="form-label">桌位二维码</text>
          <view class="qrcode-section">
            <view class="qrcode-preview" wx:if="{{currentTable.qrcode}}">
              <image class="qrcode-image" src="{{currentTable.qrcode}}" mode="aspectFit"></image>
              <view class="qrcode-actions">
                <button class="qrcode-btn view-btn" bindtap="viewQRCode">查看</button>
                <button class="qrcode-btn delete-btn" bindtap="deleteQRCode">删除</button>
              </view>
            </view>
            <view class="qrcode-upload" wx:else>
              <view class="upload-area" bindtap="uploadQRCode">
                <text class="upload-icon">+</text>
                <text class="upload-text">上传二维码图片</text>
                <text class="upload-desc">支持JPG、PNG格式，建议尺寸200x200px</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="closeModal">取消</button>
        <button class="confirm-btn" bindtap="confirmTable">确定</button>
      </view>
    </view>
  </view>
</view> 