<!-- 酒单管理页面 -->
<view class="container">
  <!-- 顶部栏 -->
  <view class="header">
    <view class="back-btn" bindtap="navigateBack">
      <image src="/static/images/icons/back.png" mode="aspectFit"></image>
    </view>
    <text class="title">酒单管理</text>
    <view class="add-btn" bindtap="openAddCategoryModal">
      <image src="/static/images/icons/add.png" mode="aspectFit"></image>
    </view>
  </view>

  <!-- 顶部菜单栏 -->
  <view class="menu-tabs">
    <view class="menu-tab {{menuType === 'regular' ? 'active' : ''}}" bindtap="switchMenuType" data-type="regular">常规酒单</view>
    <view class="menu-tab {{menuType === 'diy' ? 'active' : ''}}" bindtap="switchMenuType" data-type="diy">DIY酒料</view>
  </view>

  <!-- 常规酒单内容 -->
  <block wx:if="{{menuType === 'regular'}}">
    <!-- 分类导航 -->
    <view class="categories-nav">
      <scroll-view class="categories-scroll" scroll-x="true" enhanced="true" show-scrollbar="false">
        <view 
          class="category-item {{currentCategoryId === item.id ? 'active' : ''}}" 
          wx:for="{{categories}}" 
          wx:key="id"
          data-id="{{item.id}}"
          bindtap="switchCategory">
          {{item.name}}
        </view>
      </scroll-view>
      <view class="category-actions" wx:if="{{categories.length > 0}}">
        <view class="action-btn edit-category-btn" bindtap="openEditCategoryModal">
          <image src="/static/images/icons/edit.png" mode="aspectFit"></image>
        </view>
        <view class="action-btn delete-category-btn" bindtap="openDeleteCategoryModal">
          <image src="/static/images/icons/delete.png" mode="aspectFit"></image>
        </view>
      </view>
    </view>

    <!-- 酒水列表 -->
    <view class="drink-list" wx:if="{{filteredDrinks.length > 0}}">
      <view class="drink-item" wx:for="{{filteredDrinks}}" wx:key="id">
        <view class="drink-info">
          <image class="drink-image" src="{{item.image || '/static/images/default-drink.png'}}" mode="aspectFill"></image>
          <view class="drink-detail">
            <view class="drink-name-row">
              <text class="drink-name">{{item.name}}</text>
              <text class="drink-badge" wx:if="{{item.isRecommended}}">推荐</text>
            </view>
            <view class="drink-desc">{{item.description || '暂无描述'}}</view>
            <view class="drink-price-row">
              <text class="drink-price">¥{{item.price}}</text>
              <text class="drink-original-price" wx:if="{{item.originalPrice && item.originalPrice > item.price}}">¥{{item.originalPrice}}</text>
            </view>
          </view>
        </view>
        <view class="drink-actions">
          <view class="edit-btn" bindtap="openEditDrinkModal" data-id="{{item.id}}">编辑</view>
          <view class="delete-btn" bindtap="openDeleteDrinkModal" data-id="{{item.id}}">删除</view>
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:elif="{{currentCategoryId && categories.length > 0}}">
      <image src="/static/images/empty-drinks.png" mode="aspectFit"></image>
      <text>当前分类还没有酒水</text>
      <button class="add-drink-btn" bindtap="openAddDrinkModal">添加酒水</button>
    </view>

    <view class="empty-state" wx:elif="{{categories.length === 0}}">
      <image src="/static/images/empty-category.png" mode="aspectFit"></image>
      <text>还没有创建分类</text>
      <button class="add-category-btn" bindtap="openAddCategoryModal">创建分类</button>
    </view>

    <!-- 添加按钮 -->
    <view class="floating-btn" bindtap="openAddDrinkModal" wx:if="{{currentCategoryId && categories.length > 0}}">
      <image src="/static/images/icons/add-white.png" mode="aspectFit"></image>
    </view>
  </block>

  <!-- DIY酒料管理内容 -->
  <block wx:if="{{menuType === 'diy'}}">
    <!-- DIY酒料分类导航 -->
    <view class="categories-nav">
      <scroll-view class="categories-scroll" scroll-x="true" enhanced="true" show-scrollbar="false">
        <view 
          class="category-item {{currentDiyTypeId === item.id ? 'active' : ''}}" 
          wx:for="{{diyTypes}}" 
          wx:key="id"
          data-id="{{item.id}}"
          bindtap="switchDiyType">
          {{item.name}}
        </view>
      </scroll-view>
      <view class="category-actions" wx:if="{{diyTypes.length > 0}}">
        <view class="action-btn edit-category-btn" bindtap="openEditDiyTypeModal">
          <image src="/static/images/icons/edit.png" mode="aspectFit"></image>
        </view>
        <view class="action-btn delete-category-btn" bindtap="openDeleteDiyTypeModal">
          <image src="/static/images/icons/delete.png" mode="aspectFit"></image>
        </view>
      </view>
    </view>

    <!-- DIY酒料列表 -->
    <view class="diy-list" wx:if="{{filteredDiyIngredients.length > 0}}">
      <view class="diy-item" wx:for="{{filteredDiyIngredients}}" wx:key="id">
        <view class="diy-info">
          <image class="diy-image" src="{{item.image || '/static/images/default-ingredient.png'}}" mode="aspectFill"></image>
          <view class="diy-detail">
            <view class="diy-name-row">
              <text class="diy-name">{{item.name}}</text>
            </view>
            <view class="diy-desc">{{item.description || '暂无描述'}}</view>
            <view class="diy-price-row" wx:if="{{item.price > 0}}">
              <text class="diy-price">¥{{item.price}}</text>
              <text class="diy-unit">/{{item.unit}}</text>
            </view>
          </view>
        </view>
        <view class="diy-actions">
          <view class="edit-btn" bindtap="openEditDiyIngredientModal" data-id="{{item.id}}">编辑</view>
          <view class="delete-btn" bindtap="openDeleteDiyIngredientModal" data-id="{{item.id}}">删除</view>
        </view>
      </view>
    </view>

    <!-- DIY酒料空状态 -->
    <view class="empty-state" wx:elif="{{currentDiyTypeId && diyTypes.length > 0}}">
      <image src="/static/images/empty-ingredients.png" mode="aspectFit"></image>
      <text>当前分类还没有酒料</text>
      <button class="add-diy-btn" bindtap="openAddDiyIngredientModal">添加酒料</button>
    </view>

    <view class="empty-state" wx:elif="{{diyTypes.length === 0}}">
      <image src="/static/images/empty-category.png" mode="aspectFit"></image>
      <text>还没有创建DIY酒料分类</text>
      <button class="add-category-btn" bindtap="openAddDiyTypeModal">创建酒料分类</button>
    </view>

    <!-- 添加DIY酒料按钮 -->
    <view class="floating-btn" bindtap="openAddDiyIngredientModal" wx:if="{{currentDiyTypeId && diyTypes.length > 0}}">
      <image src="/static/images/icons/add-white.png" mode="aspectFit"></image>
    </view>
  </block>

  <!-- 分类模态框 -->
  <view class="modal" wx:if="{{showCategoryModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text>{{isEditingCategory ? '编辑分类' : '添加分类'}}</text>
        <view class="close-btn" bindtap="closeCategoryModal">×</view>
      </view>
      <view class="modal-body">
        <view class="form-group">
          <label>分类名称</label>
          <input 
            type="text" 
            placeholder="请输入分类名称" 
            value="{{tempCategory.name}}" 
            bindinput="onCategoryNameInput"
          />
        </view>
        <view class="form-group">
          <label>排序 (数字越小排序越靠前)</label>
          <input 
            type="number" 
            placeholder="请输入排序数字" 
            value="{{tempCategory.sort}}" 
            bindinput="onCategorySortInput"
          />
        </view>
      </view>
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="closeCategoryModal">取消</button>
        <button class="confirm-btn" bindtap="saveCategory">确定</button>
      </view>
    </view>
  </view>

  <!-- DIY酒料分类模态框 -->
  <view class="modal" wx:if="{{showDiyTypeModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text>{{isEditingDiyType ? '编辑酒料分类' : '添加酒料分类'}}</text>
        <view class="close-btn" bindtap="closeDiyTypeModal">×</view>
      </view>
      <view class="modal-body">
        <view class="form-group">
          <label>分类名称</label>
          <input 
            type="text" 
            placeholder="请输入分类名称" 
            value="{{tempDiyType.name}}" 
            bindinput="onDiyTypeNameInput"
          />
        </view>
        <view class="form-group">
          <label>排序 (数字越小排序越靠前)</label>
          <input 
            type="number" 
            placeholder="请输入排序数字" 
            value="{{tempDiyType.sort}}" 
            bindinput="onDiyTypeSortInput"
          />
        </view>
      </view>
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="closeDiyTypeModal">取消</button>
        <button class="confirm-btn" bindtap="saveDiyType">确定</button>
      </view>
    </view>
  </view>

  <!-- 酒水模态框 -->
  <view class="modal" wx:if="{{showDrinkModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text>{{isEditingDrink ? '编辑酒水' : '添加酒水'}}</text>
        <view class="close-btn" bindtap="closeDrinkModal">×</view>
      </view>
      <view class="modal-body">
        <view class="image-upload" bindtap="uploadDrinkImage">
          <image 
            class="drink-image-preview" 
            src="{{tempDrink.image || '/static/images/default-drink.png'}}" 
            mode="aspectFill"
          ></image>
          <view class="upload-icon">
            <image src="/static/images/icons/camera.png" mode="aspectFit"></image>
          </view>
        </view>

        <view class="form-group">
          <label>酒水名称</label>
          <input 
            type="text" 
            placeholder="请输入酒水名称" 
            value="{{tempDrink.name}}" 
            bindinput="onDrinkNameInput"
          />
        </view>

        <view class="form-group">
          <label>描述</label>
          <textarea 
            placeholder="请输入酒水描述" 
            value="{{tempDrink.description}}" 
            bindinput="onDrinkDescInput"
          ></textarea>
        </view>

        <view class="form-group">
          <label>价格 (元)</label>
          <input 
            type="digit" 
            placeholder="请输入价格" 
            value="{{tempDrink.price}}" 
            bindinput="onDrinkPriceInput"
          />
        </view>

        <view class="form-group">
          <label>原价 (元，可选)</label>
          <input 
            type="digit" 
            placeholder="请输入原价" 
            value="{{tempDrink.originalPrice}}" 
            bindinput="onDrinkOriginalPriceInput"
          />
        </view>

        <view class="form-group">
          <label>排序 (数字越小排序越靠前)</label>
          <input 
            type="number" 
            placeholder="请输入排序数字" 
            value="{{tempDrink.sort}}" 
            bindinput="onDrinkSortInput"
          />
        </view>

        <view class="form-group switch-group">
          <label>推荐酒水</label>
          <switch 
            checked="{{tempDrink.isRecommended}}" 
            color="#1989fa" 
            bindchange="onDrinkRecommendedChange"
          ></switch>
        </view>

        <view class="form-group switch-group">
          <label>上架状态</label>
          <switch 
            checked="{{tempDrink.isAvailable}}" 
            color="#1989fa" 
            bindchange="onDrinkAvailableChange"
          ></switch>
        </view>

        <view class="form-group switch-group">
          <label>启用点单制</label>
          <switch 
            checked="{{tempDrink.enableOrdering}}" 
            color="#1989fa" 
            bindchange="onDrinkOrderingChange"
          ></switch>
        </view>
        <view class="form-tip">
          <text class="tip-text">开启后，顾客可以通过扫码点单选择此酒水</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="closeDrinkModal">取消</button>
        <button class="confirm-btn" bindtap="saveDrink">确定</button>
      </view>
    </view>
  </view>

  <!-- DIY酒料模态框 -->
  <view class="modal" wx:if="{{showDiyIngredientModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text>{{isEditingDiyIngredient ? '编辑酒料' : '添加酒料'}}</text>
        <view class="close-btn" bindtap="closeDiyIngredientModal">×</view>
      </view>
      <view class="modal-body">
        <view class="image-upload" bindtap="uploadDiyIngredientImage">
          <image 
            class="drink-image-preview" 
            src="{{tempDiyIngredient.image || '/static/images/default-ingredient.png'}}" 
            mode="aspectFill"
          ></image>
          <view class="upload-icon">
            <image src="/static/images/icons/camera.png" mode="aspectFit"></image>
          </view>
        </view>

        <view class="form-group">
          <label>酒料名称</label>
          <input 
            type="text" 
            placeholder="请输入酒料名称" 
            value="{{tempDiyIngredient.name}}" 
            bindinput="onDiyIngredientNameInput"
          />
        </view>

        <view class="form-group">
          <label>描述</label>
          <textarea 
            placeholder="请输入酒料描述" 
            value="{{tempDiyIngredient.description}}" 
            bindinput="onDiyIngredientDescInput"
          ></textarea>
        </view>

        <view class="form-group">
          <label>附加价格 (元，可选)</label>
          <input 
            type="digit" 
            placeholder="请输入附加价格，0表示免费" 
            value="{{tempDiyIngredient.price}}" 
            bindinput="onDiyIngredientPriceInput"
          />
        </view>

        <view class="form-group">
          <label>计量单位</label>
          <input 
            type="text" 
            placeholder="例如：份、杯、瓶等" 
            value="{{tempDiyIngredient.unit}}" 
            bindinput="onDiyIngredientUnitInput"
          />
        </view>

        <view class="form-group">
          <label>排序 (数字越小排序越靠前)</label>
          <input 
            type="number" 
            placeholder="请输入排序数字" 
            value="{{tempDiyIngredient.sort}}" 
            bindinput="onDiyIngredientSortInput"
          />
        </view>

        <view class="form-group switch-group">
          <label>推荐酒料</label>
          <switch 
            checked="{{tempDiyIngredient.isRecommended}}" 
            color="#1989fa" 
            bindchange="onDiyIngredientRecommendedChange"
          ></switch>
        </view>

        <view class="form-group switch-group">
          <label>上架状态</label>
          <switch 
            checked="{{tempDiyIngredient.isAvailable}}" 
            color="#1989fa" 
            bindchange="onDiyIngredientAvailableChange"
          ></switch>
        </view>
      </view>
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="closeDiyIngredientModal">取消</button>
        <button class="confirm-btn" bindtap="saveDiyIngredient">确定</button>
      </view>
    </view>
  </view>

  <!-- 删除分类确认模态框 -->
  <view class="confirm-modal" wx:if="{{showDeleteCategoryModal}}">
    <view class="confirm-content">
      <view class="confirm-title">确认删除</view>
      <view class="confirm-text">删除分类将同时删除该分类下的所有酒水，此操作不可恢复，确定要删除吗？</view>
      <view class="confirm-btns">
        <button class="cancel-btn" bindtap="closeDeleteCategoryModal">取消</button>
        <button class="delete-btn" bindtap="deleteCategory">删除</button>
      </view>
    </view>
  </view>

  <!-- 删除DIY酒料分类确认模态框 -->
  <view class="confirm-modal" wx:if="{{showDeleteDiyTypeModal}}">
    <view class="confirm-content">
      <view class="confirm-title">确认删除</view>
      <view class="confirm-text">删除分类将同时删除该分类下的所有DIY酒料，此操作不可恢复，确定要删除吗？</view>
      <view class="confirm-btns">
        <button class="cancel-btn" bindtap="closeDeleteDiyTypeModal">取消</button>
        <button class="delete-btn" bindtap="deleteDiyType">删除</button>
      </view>
    </view>
  </view>

  <!-- 删除酒水确认模态框 -->
  <view class="confirm-modal" wx:if="{{showDeleteDrinkModal}}">
    <view class="confirm-content">
      <view class="confirm-title">确认删除</view>
      <view class="confirm-text">删除酒水后将无法恢复，确定要删除吗？</view>
      <view class="confirm-btns">
        <button class="cancel-btn" bindtap="closeDeleteDrinkModal">取消</button>
        <button class="delete-btn" bindtap="deleteDrink">删除</button>
      </view>
    </view>
  </view>

  <!-- 删除DIY酒料确认模态框 -->
  <view class="confirm-modal" wx:if="{{showDeleteDiyIngredientModal}}">
    <view class="confirm-content">
      <view class="confirm-title">确认删除</view>
      <view class="confirm-text">删除酒料后将无法恢复，确定要删除吗？</view>
      <view class="confirm-btns">
        <button class="cancel-btn" bindtap="closeDeleteDiyIngredientModal">取消</button>
        <button class="delete-btn" bindtap="deleteDiyIngredient">删除</button>
      </view>
    </view>
  </view>
</view> 